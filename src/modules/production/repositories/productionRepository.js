const Produccion = require('../models/Produccion');const { Op } = require('sequelize');class ProductionRepository {  async findAll(filtros = {}) {    const where = {};    if (filtros.activo !== undefined) {      where.activo = filtros.activo;    }    if (filtros.fechaDesde || filtros.fechaHasta) {      where.fecha = {};      if (filtros.fechaDesde) {        where.fecha[Op.gte] = filtros.fechaDesde;      }      if (filtros.fechaHasta) {        where.fecha[Op.lte] = filtros.fechaHasta;      }    }    if (filtros.fecha) {      where.fecha = filtros.fecha;    }    return await Produccion.findAll({      where,      order: [['fecha', 'DESC']]    });  }  async findById(id) {    return await Produccion.findByPk(id);  }  async findByFecha(fecha) {    return await Produccion.findOne({      where: { fecha }    });  }  async create(datos) {    return await Produccion.create(datos);  }  async update(id, datos) {    const produccion = await Produccion.findByPk(id);    if (!produccion) {      throw new Error('Registro de producción no encontrado');    }    await produccion.update(datos);    return produccion.reload();  }  async delete(id) {    const produccion = await Produccion.findByPk(id);    if (!produccion) {      throw new Error('Registro de producción no encontrado');    }    await produccion.update({ activo: false });    return true;  }  async obtenerEstadisticas(fechaDesde, fechaHasta) {    const where = {      activo: true    };    if (fechaDesde || fechaHasta) {      where.fecha = {};      if (fechaDesde) {        where.fecha[Op.gte] = fechaDesde;      }      if (fechaHasta) {        where.fecha[Op.lte] = fechaHasta;      }    }    const registros = await Produccion.findAll({      where,      attributes: [        [Produccion.sequelize.fn('SUM', Produccion.sequelize.col('charolasCuartoKilo')), 'totalCuartos'],        [Produccion.sequelize.fn('SUM', Produccion.sequelize.col('charolasMedioKilo')), 'totalMedios'],        [Produccion.sequelize.fn('SUM', Produccion.sequelize.col('domosUnKilo')), 'totalUnKilo'],        [Produccion.sequelize.fn('SUM', Produccion.sequelize.col('totalKilos')), 'totalKilos']      ],      raw: true    });    return registros[0] || {      totalCuartos: 0,      totalMedios: 0,      totalUnKilo: 0,      totalKilos: 0    };  }}module.exports = new ProductionRepository();