const clientRepository = require('../../clients/repositories/clientRepository');const clientService = require('../../clients/services/clientService');class ClienteWhatsAppService {  async buscarOCrearCliente(telefono, nombre = null) {    try {      const telefonoLimpio = this.limpiarTelefono(telefono);      const clientes = await clientRepository.findAll({ telefono: telefonoLimpio });      if (clientes.length > 0) {        return clientes[0].toJSON();      }      const nombreCliente = nombre || `Cliente ${telefonoLimpio.slice(-4)}`;      const nuevoCliente = await clientService.crear({        nombre: nombreCliente,        telefono: telefonoLimpio,        nombre_tienda: null      });      console.log(`Cliente creado automáticamente: ${nombreCliente} (${telefonoLimpio})`);      return nuevoCliente;    } catch (error) {      console.error('Error al buscar/crear cliente:', error);      throw new Error(`Error al procesar cliente: ${error.message}`);    }  }  limpiarTelefono(telefono) {    let numero = telefono.replace('whatsapp:', '');    numero = numero.replace(/[\s\-\(\)]/g, '');    if (!numero.startsWith('+')) {      if (numero.startsWith('52')) {        numero = '+' + numero;      } else if (numero.length === 10) {        numero = '+52' + numero;      }    }    return numero;  }  async obtenerClientePorTelefono(telefono) {    try {      const telefonoLimpio = this.limpiarTelefono(telefono);      const clientes = await clientRepository.findAll({ telefono: telefonoLimpio });      if (clientes.length > 0) {        return clientes[0].toJSON();      }      return null;    } catch (error) {      console.error('Error al obtener cliente por teléfono:', error);      return null;    }  }}module.exports = new ClienteWhatsAppService();